<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel - Watch Store</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            background-color: #f8f9fa;
            display: flex;
        }

        .sidebar {
            width: 250px;
            background-color: #2c3e50;
            color: white;
            padding: 20px;
            min-height: 100vh;
            box-shadow: 2px 0 5px rgba(0,0,0,0.1);
        }

        .sidebar h2 {
            text-align: center;
            margin-bottom: 30px;
            color: #3498db;
        }

        .sidebar ul {
            list-style: none;
            padding: 0;
        }

        .sidebar ul li {
            margin-bottom: 15px;
        }

        .sidebar ul li a {
            color: white;
            text-decoration: none;
            font-size: 1.1rem;
            display: block;
            padding: 10px;
            border-radius: 4px;
            transition: background-color 0.3s ease;
        }

        .sidebar ul li a:hover,
        .sidebar ul li a.active {
            background-color: #34495e;
        }

        .main-content {
            flex-grow: 1;
            padding: 20px;
        }

        .section {
            display: none;
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .section.active {
            display: block;
        }

        .section h3 {
            margin-top: 0;
            margin-bottom: 20px;
            color: #2c3e50;
        }

        /* Form and Table Styles */
        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #555;
        }

        .form-group input[type="text"],
        .form-group input[type="number"],
        .form-group input[type="url"],
         .form-group input[type="email"],
         .form-group input[type="password"],
         .form-group input[type="checkbox"],
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 4px;
            box-sizing: border-box; /* Include padding and border in element's total width and height */
             font-size: 1rem;
        }

         .form-group input[type="checkbox"] {
            width: auto;
            margin-right: 5px;
            vertical-align: middle;
         }

        button {
            padding: 10px 15px;
            background-color: #3498db;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }

        button:hover {
            background-color: #2980b9;
        }

        button[type="submit"] {
            background-color: #27ae60;
        }

         button[type="submit"]:hover {
            background-color: #229954;
        }

        button.delete-btn {
            background-color: #e74c3c;
        }

        button.delete-btn:hover {
            background-color: #c0392b;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
             border-radius: 8px;
             overflow: hidden; /* Ensures rounded corners apply to children */
        }

        th,
        td {
            border: 1px solid #ddd;
            padding: 12px;
            text-align: left;
             /* Add some simple hover effect for rows */
             transition: background-color 0.3s ease;
        }

        tr:hover {
             background-color: #f1f1f1;
        }

        th {
            background-color: #f2f2f2;
            font-weight: bold;
            color: #555;
        }

        tr:nth-child(even) {
            background-color: #f9f9f9;
        }

        /* Notification Styles (Copied from index.html) */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 20px 30px;
            border-radius: 8px;
            color: white;
            z-index: 1000;
            animation: slideIn 0.3s ease-out;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            font-size: 1.1rem;
            max-width: 400px;
        }

        .notification.success {
            background-color: #27ae60;
        }

        .notification.error {
            background-color: #e74c3c;
        }

        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        /* Add specific styles for different sections as needed */
         #customers .form-group input[type="email"],
         #customers .form-group input[type="password"] {
             /* Specific styles for customer form inputs if needed */
         }

         .button-group button {
             margin-right: 5px;
        }

        /* Enhanced Modal Styles */
        .modal, .admin-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            z-index: 1000;
            overflow-y: auto;
            padding: 20px;
            backdrop-filter: blur(5px);
        }

        .modal-content, .admin-modal-content {
            background: white;
            margin: 5% auto;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 5px 30px rgba(0, 0, 0, 0.3);
            position: relative;
            max-width: 800px;
            width: 90%;
            animation: modalSlideIn 0.3s ease-out;
            max-height: 85vh;
            overflow-y: auto;
        }

        @keyframes modalSlideIn {
            from {
                transform: translateY(-50px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .close-button, .close-modal {
            position: absolute;
            top: 15px;
            right: 20px;
            font-size: 28px;
            font-weight: bold;
            color: #666;
            cursor: pointer;
            transition: color 0.3s ease;
            background: none;
            border: none;
            padding: 5px;
            line-height: 1;
            z-index: 1001;
        }

        .close-button:hover, .close-modal:hover {
            color: #333;
        }

        /* Product Modal Specific Styles */
        #productModal .modal-content {
            max-width: 700px;
            display: flex;
            flex-direction: column;
        }

        #productForm {
            display: grid;
            gap: 20px;
            overflow-y: auto;
            padding-right: 10px;
        }

        #productForm label {
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 5px;
            display: block;
        }

        #productForm input[type="text"],
        #productForm input[type="number"],
        #productForm input[type="url"],
        #productForm textarea,
        #productForm select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s ease;
        }

        #productForm input:focus,
        #productForm textarea:focus,
        #productForm select:focus {
            border-color: #3498db;
            outline: none;
        }

        #productForm textarea {
            min-height: 100px;
            resize: vertical;
        }

        .image-url-input-group {
            display: flex;
            gap: 10px;
            align-items: center;
            margin-bottom: 10px;
            background: #f8f9fa;
            padding: 10px;
            border-radius: 8px;
            transition: all 0.3s ease;
        }

        .image-url-input-group:hover {
            background: #e9ecef;
        }

        .image-url-input-group input {
            flex: 1;
            padding: 8px 12px;
            border: 2px solid #e0e0e0;
            border-radius: 6px;
            transition: border-color 0.3s ease;
        }

        .image-url-input-group input:focus {
            border-color: #3498db;
            outline: none;
        }

        .preview-image-btn, .remove-image-url-btn {
            padding: 8px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 36px;
            height: 36px;
        }

        .preview-image-btn {
            background-color: #3498db;
            color: white;
        }

        .preview-image-btn:hover {
            background-color: #2980b9;
        }

        .remove-image-url-btn {
            background-color: #e74c3c;
            color: white;
        }

        .remove-image-url-btn:hover {
            background-color: #c0392b;
        }

        .image-preview-container {
            margin-top: 20px;
            text-align: center;
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
        }

        #previewImage {
            max-width: 100%;
            height: auto;
            border-radius: 4px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        /* Order Details Modal Specific Styles */
        .order-details-modal-content {
            max-width: 800px;
        }

        .order-details-modal-content h3 {
            color: #2c3e50;
            margin-bottom: 25px;
            font-size: 24px;
            border-bottom: 2px solid #3498db;
            padding-bottom: 10px;
        }

        #orderDetailsContent {
            display: grid;
            gap: 20px;
        }

        #orderDetailsContent p {
            margin: 0;
            padding: 12px;
            background: #f8f9fa;
            border-radius: 8px;
            border-left: 4px solid #3498db;
        }

        #orderDetailsContent h4 {
            color: #2c3e50;
            margin: 20px 0 10px;
            font-size: 18px;
        }

        #orderDetailsContent ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        #orderDetailsContent ul li {
            padding: 10px;
            background: #f8f9fa;
            margin-bottom: 8px;
            border-radius: 6px;
            border-left: 4px solid #2ecc71;
        }

        #orderDetailsContent strong {
            color: #2c3e50;
            font-weight: 600;
        }

        /* Status Colors */
        .status-pending { color: #f39c12; }
        .status-processing { color: #3498db; }
        .status-shipped { color: #9b59b6; }
        .status-delivered { color: #2ecc71; }
        .status-cancelled { color: #e74c3c; }

        /* Dashboard Styles */
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .dashboard-card {
            background: linear-gradient(135deg, #2c3e50, #3498db);
            color: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            display: flex;
            align-items: center;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .dashboard-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(45deg, rgba(255,255,255,0.1), rgba(255,255,255,0));
            z-index: 1;
        }

        .dashboard-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.2);
        }

        .dashboard-card i {
            font-size: 2.5rem;
            margin-right: 20px;
            color: rgba(255,255,255,0.9);
            z-index: 2;
        }

        .card-content {
            z-index: 2;
        }

        .card-content h4 {
            margin: 0;
            font-size: 1.1rem;
            font-weight: 500;
            opacity: 0.9;
        }

        .card-content p {
            margin: 5px 0 0;
            font-size: 1.8rem;
            font-weight: bold;
        }

        .dashboard-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }

        .stats-card {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            transition: transform 0.3s ease;
        }

        .stats-card:hover {
            transform: translateY(-3px);
        }

        .stats-card h4 {
            margin: 0 0 20px;
            color: #2c3e50;
            font-size: 1.2rem;
            border-bottom: 2px solid #3498db;
            padding-bottom: 10px;
        }

        .activity-list, .quick-stats {
            max-height: 300px;
            overflow-y: auto;
            padding-right: 10px;
        }

        .activity-list::-webkit-scrollbar, .quick-stats::-webkit-scrollbar {
            width: 6px;
        }

        .activity-list::-webkit-scrollbar-thumb, .quick-stats::-webkit-scrollbar-thumb {
            background: #3498db;
            border-radius: 3px;
        }

        .activity-list p, .quick-stats p {
            margin: 10px 0;
            padding: 12px;
            background: #f8f9fa;
            border-radius: 8px;
            border-left: 4px solid #3498db;
            transition: transform 0.2s ease;
        }

        .activity-list p:hover, .quick-stats p:hover {
            transform: translateX(5px);
        }

        /* Features Section in Product Form */
        .features-container {
            margin-top: 20px;
        }

        .feature-item {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
            align-items: center;
        }

        .feature-item input[type="text"] {
            flex: 1;
        }

        .add-feature-btn {
            background-color: #2ecc71;
            color: white;
            padding: 8px 15px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            margin-top: 10px;
        }

        .add-feature-btn:hover {
            background-color: #27ae60;
            transform: translateY(-2px);
        }

        .remove-feature-btn {
            background-color: #e74c3c;
            color: white;
            padding: 8px 15px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .remove-feature-btn:hover {
            background-color: #c0392b;
        }

        /* Custom Scrollbar Styles */
        .modal-content::-webkit-scrollbar,
        #productForm::-webkit-scrollbar {
            width: 8px;
        }

        .modal-content::-webkit-scrollbar-track,
        #productForm::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 4px;
        }

        .modal-content::-webkit-scrollbar-thumb,
        #productForm::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 4px;
        }

        .modal-content::-webkit-scrollbar-thumb:hover,
        #productForm::-webkit-scrollbar-thumb:hover {
            background: #555;
        }

        /* Search Bar Styles */
        .search-container {
            margin-bottom: 20px;
            display: flex;
            gap: 10px;
        }

        .search-container input[type="text"] {
            flex: 1;
            padding: 10px 15px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 16px;
        }

        .search-container button {
            padding: 10px 20px;
        }

    </style>
</head>
<body>
    <div class="sidebar">
        <h2>Admin Panel</h2>
        <ul>
            <li><a href="#" class="active" onclick="showSection('dashboard')">Dashboard</a></li>
            <li><a href="#" onclick="showSection('products')">Products</a></li>
            <li><a href="#" onclick="showSection('discounts')">Discounts</a></li>
            <li><a href="#" onclick="showSection('customers')">Customers</a></li>
            <li><a href="#" onclick="showSection('orders')">Orders</a></li>
        </ul>
    </div>

    <div class="main-content">
        <div id="dashboard" class="section active">
            <h3>Dashboard Overview</h3>
            <div class="dashboard-grid">
                <div class="dashboard-card">
                    <i class="fas fa-box"></i>
                    <div class="card-content">
                        <h4>Total Products</h4>
                        <p id="totalProducts">...</p>
                    </div>
                </div>
                <div class="dashboard-card">
                    <i class="fas fa-shopping-cart"></i>
                    <div class="card-content">
                        <h4>Total Orders</h4>
                        <p id="totalOrders">...</p>
                    </div>
                </div>
                <div class="dashboard-card">
                    <i class="fas fa-users"></i>
                    <div class="card-content">
                        <h4>Total Customers</h4>
                        <p id="totalCustomers">...</p>
                    </div>
                </div>
                <div class="dashboard-card">
                    <i class="fas fa-tags"></i>
                    <div class="card-content">
                        <h4>Total Discounts</h4>
                        <p id="totalDiscounts">...</p>
                    </div>
                </div>
            </div>
            <div class="dashboard-stats">
                <div class="stats-card">
                    <h4>Recent Activity</h4>
                    <div id="recentActivity" class="activity-list">
                        <p>Loading recent activity...</p>
                    </div>
                </div>
                <div class="stats-card">
                    <h4>Quick Stats</h4>
                    <div id="quickStats" class="quick-stats">
                        <p>Loading quick stats...</p>
                    </div>
                </div>
            </div>
        </div>

        <div id="products" class="section">
            <h3>Product Management</h3>
            
            <div class="search-container">
                <input type="text" id="productSearch" placeholder="Search products by name..." onkeyup="searchProducts()">
                <button onclick="searchProducts()">Search</button>
            </div>

            <!-- Button to open Add Product Modal -->
            <button onclick="showAddProductModal()">Add New Product</button>

            <!-- Product List -->
            <div class="product-list-container" style="margin-top: 20px;">
                <h4>Existing Products</h4>
                <table id="productsTable" style="width: 100%; border-collapse: collapse;">
                    <thead>
                        <tr>
                            <th>Image</th>
                            <th>Name</th>
                            <th>Price</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Product rows will be inserted here by JavaScript -->
                    </tbody>
                </table>
                 <p id="noProductsMessage" style="text-align: center; margin-top: 20px; display: none;">No products found.</p>
            </div>

            <!-- Product Form Modal -->
            <div id="productModal" class="modal">
                <div class="modal-content">
                    <span class="close-button" onclick="closeModal('productModal')">&times;</span>
                    <h2>Add/Edit Product</h2>
                 <form id="productForm" onsubmit="saveProduct(event)">
                        <input type="hidden" id="productId">
                        <label for="productName">Name:</label>
                        <input type="text" id="productName" required>

                        <label for="productDescription">Description:</label>
                        <textarea id="productDescription" required></textarea>

                        <label for="productPrice">Price:</label>
                        <input type="number" id="productPrice" step="0.01" required>

                        <label for="productCategory">Category:</label>
                        <input type="text" id="productCategory" required>

                        <label>Image URLs:</label>
                        <div id="imageUrlsContainer">
                            <div class="image-url-input-group">
                                <input type="url" class="image-url-input" placeholder="Enter image URL" required>
                                <button type="button" class="preview-image-btn" onclick="previewImage(this.parentElement.querySelector('input').value)">
                                    <i class="fas fa-eye"></i>
                                </button>
                                <button type="button" class="remove-image-url-btn" onclick="removeImageUrlInput(this.parentElement)" style="display: none;">
                                    <i class="fas fa-minus"></i>
                                </button>
                            </div>
                        </div>
                        <button type="button" id="addImageUrlButton" style="margin-top: 10px;" onclick="addImageUrlInput()">Add Another Image URL</button>

                        <div class="features-container">
                            <h4>Product Features</h4>
                            <div id="featuresContainer">
                                <div class="feature-item">
                                    <input type="text" class="feature-input" placeholder="Enter feature" required>
                                    <button type="button" class="remove-feature-btn" onclick="removeFeatureInput(this.parentElement)" style="display: none;">
                                        <i class="fas fa-minus"></i>
                                    </button>
                                </div>
                            </div>
                            <button type="button" class="add-feature-btn" onclick="addFeatureInput()">
                                <i class="fas fa-plus"></i> Add Feature
                            </button>
                        </div>
<!-- Add this inside the productForm in the modal -->

                        <button type="submit" id="saveProductButton">Save Product</button>
                    </form>
                </div>
            </div>

        </div>

        <div id="discounts" class="section">
            <h3>Discounts Management</h3>
            
            <!-- Discount Form (Add/Edit) -->
            <div class="discount-form-container" style="margin-bottom: 30px;">
                <h4>Add New Discount</h4>
                <form id="discountForm">
                    <input type="hidden" id="discountId">
                    <div class="form-group">
                        <label for="discountCode">Code:</label>
                        <input type="text" id="discountCode" required>
                    </div>
                    <div class="form-group">
                        <label for="discountType">Type:</label>
                        <select id="discountType" required>
                            <option value="percentage">Percentage</option>
                            <option value="fixed">Fixed Amount</option>
                        </select>
                    </div>
                     <div class="form-group">
                        <label for="discountValue">Value:</label>
                        <input type="number" id="discountValue" step="0.01" required>
                    </div>
                     <div class="form-group">
                        <input type="checkbox" id="discountActive">
                        <label for="discountActive" style="display: inline-block;">Active</label>
                    </div>
                    <!-- Add fields for expiry date, usage limit etc. if needed -->
                    <button type="submit">Add Discount</button>
                    <button type="button" onclick="cancelDiscountEdit()">Cancel Edit</button>
                </form>
            </div>

            <p>Manage your discount coupons here.</p>
            <!-- Discounts management content goes here -->
            <div id="discountsList">
                <h4>Existing Discounts</h4>
                 <table id="discountsTable" style="width: 100%; border-collapse: collapse;">
                    <thead>
                        <tr>
                            <th>Code</th>
                            <th>Type</th>
                            <th>Value</th>
                            <th>Active</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Discount rows will be inserted here by JavaScript -->
                    </tbody>
                </table>
                 <p id="noDiscountsMessage" style="text-align: center; margin-top: 20px; display: none;">No discounts found.</p>
            </div>
            <!-- Optional: Add form for adding/editing discounts -->
        </div>

        <div id="customers" class="section">
            <h3>Customer Management</h3>
            
            <!-- Customer Form (Add/Edit) -->
            <div class="customer-form-container" style="margin-bottom: 30px;">
                <h4>Add New Customer</h4>
                <form id="customerForm">
                    <input type="hidden" id="customerId">
                    <div class="form-group">
                        <label for="customerName">Name:</label>
                        <input type="text" id="customerName" required>
                    </div>
                    <div class="form-group">
                        <label for="customerEmail">Email:</label>
                        <input type="email" id="customerEmail" required>
                    </div>
                     <!-- Password fields only needed for adding new customer -->
                     <div id="customerPasswordFields">
                         <div class="form-group">
                            <label for="customerPassword">Password:</label>
                            <input type="password" id="customerPassword" required>
                        </div>
                         <div class="form-group">
                            <label for="customerConfirmPassword">Confirm Password:</label>
                            <input type="password" id="customerConfirmPassword" required>
                        </div>
                     </div>
                    <!-- Add more customer fields if needed -->
                    <button type="submit">Add Customer</button>
                    <button type="button" onclick="cancelCustomerEdit()">Cancel Edit</button>
                </form>
            </div>

            <p>View and manage your customer base.</p>
            <!-- Customer management content goes here -->
             <div id="customersList">
                <h4>Registered Customers</h4>
                 <table id="customersTable" style="width: 100%; border-collapse: collapse;">
                    <thead>
                        <tr>
                            <th>Email</th>
                            <th>Name</th>
                            <th>Member Since</th>
                             <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Customer rows will be inserted here by JavaScript -->
                    </tbody>
                </table>
                <p id="noCustomersMessage" style="text-align: center; margin-top: 20px; display: none;">No customers found.</p>
            </div>
        </div>

        <div id="orders" class="section">
            <h3>Order Management</h3>
            <p>View and manage customer orders.</p>
            
             <div id="ordersListContainer">
                <h4>Recent Orders</h4>
                 <table id="ordersTable" style="width: 100%; border-collapse: collapse;">
                    <thead>
                        <tr>
                            <th>Order ID</th>
                            <th>Customer Email</th>
                            <th>Date</th>
                            <th>Total</th>
                            <th>Status</th>
                             <th>Payment</th>
                             <th>Delivery</th>
                             <th>Items</th>
                             <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Order rows will be inserted here by JavaScript -->
                    </tbody>
                </table>
                 <p id="noOrdersMessage" style="text-align: center; margin-top: 20px; display: none;">No orders found.</p>
            </div>

            <!-- Order Details Modal -->
            <div id="orderDetailsModal" class="admin-modal">
                <div class="admin-modal-content order-details-modal-content">
                    <span class="close-modal" onclick="closeModal('orderDetailsModal')">&times;</span>
                    <h3>Order Details - #<span id="orderDetailsId"></span></h3>
                    <div id="orderDetailsContent">
                        <!-- Order details will be loaded here -->
                    </div>
                </div>
            </div>

        </div>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>

    <script>
        // Firebase configuration (replace with your actual config)
        const firebaseConfig = {
            apiKey: "AIzaSyD39O9YzwSUfuGx2x3CMphVeH9gtYe8bqc",
            authDomain: "e-commerece-c160d.firebaseapp.com",
            projectId: "e-commerece-c160d",
            storageBucket: "e-commerece-c160d.firebasestorage.app",
            messagingSenderId: "726394585881",
            appId: "1:726394585881:web:50fc8b7c431e120c283b88"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);

        // Initialize Firestore and Auth
        const db = firebase.firestore();
        const auth = firebase.auth();

        // Function to show selected section
        function showSection(sectionId) {
            // Hide all sections first
            const sections = document.querySelectorAll('.section');
            sections.forEach(section => {
                section.classList.remove('active');
            });

            // Show the target section
            const targetSection = document.getElementById(sectionId);
            if (targetSection) {
                targetSection.classList.add('active');
            }

            // Update active navigation link
            const navLinks = document.querySelectorAll('.sidebar ul li a');
            navLinks.forEach(link => {
                link.classList.remove('active');
                if (link.getAttribute('onclick').includes(`showSection('${sectionId}')`)) {
                    link.classList.add('active');
                }
            });

            // Load section-specific data
            if (sectionId === 'dashboard') {
                loadDashboard();
            } else if (sectionId === 'products') {
                loadProducts();
            } else if (sectionId === 'discounts') {
                loadDiscounts();
            } else if (sectionId === 'customers') {
                loadCustomers();
            } else if (sectionId === 'orders') {
                loadOrders();
            }
        }

        // Enhanced Load Dashboard Stats Function
        async function loadDashboard() {
            console.log('Loading dashboard stats...');
            try {
                // Load basic stats
                const productsSnapshot = await db.collection('products').get();
                const totalProducts = productsSnapshot.size;
                document.getElementById('totalProducts').textContent = totalProducts;

                const ordersSnapshot = await db.collection('orders').get();
                const totalOrders = ordersSnapshot.size;
                document.getElementById('totalOrders').textContent = totalOrders;

                const customersSnapshot = await db.collection('users').get();
                const totalCustomers = customersSnapshot.size;
                document.getElementById('totalCustomers').textContent = totalCustomers;

                const discountsSnapshot = await db.collection('coupons').get();
                const totalDiscounts = discountsSnapshot.size;
                document.getElementById('totalDiscounts').textContent = totalDiscounts;

                // Load recent activity
                const recentOrders = await db.collection('orders')
                    .orderBy('createdAt', 'desc')
                    .limit(5)
                    .get();

                const recentActivity = document.getElementById('recentActivity');
                recentActivity.innerHTML = '';
                
                if (recentOrders.empty) {
                    recentActivity.innerHTML = '<p>No recent activity</p>';
                } else {
                    recentOrders.forEach(doc => {
                        const order = doc.data();
                        const date = order.createdAt ? new Date(order.createdAt.toDate()).toLocaleString() : 'N/A';
                        recentActivity.innerHTML += `
                            <p>New order #${doc.id.slice(-6)} - ${date}</p>
                        `;
                    });
                }

                // Load quick stats
                const quickStats = document.getElementById('quickStats');
                const totalRevenue = ordersSnapshot.docs.reduce((sum, doc) => {
                    const order = doc.data();
                    return sum + (order.total || 0);
                }, 0);

                const averageOrderValue = totalOrders > 0 ? totalRevenue / totalOrders : 0;
                const activeDiscounts = discountsSnapshot.docs.filter(doc => doc.data().active).length;

                quickStats.innerHTML = `
                    <p>Total Revenue: PKR ${totalRevenue.toFixed(2)}</p>
                    <p>Average Order Value: PKR ${averageOrderValue.toFixed(2)}</p>
                    <p>Active Discounts: ${activeDiscounts}</p>
                `;

            } catch (error) {
                console.error('Error loading dashboard stats:', error);
                document.getElementById('dashboardStats').innerHTML = '<p style="color: red;">Error loading dashboard stats.</p>';
            }
        }

        // Initialize the dashboard when the page loads
        document.addEventListener('DOMContentLoaded', function() {
            // Show dashboard section by default
            showSection('dashboard');
        });

        // Modal handling functions
        function showModal(modalId) {
            const modal = document.getElementById(modalId);
            if (modal) {
                modal.style.display = 'block';
            }
        }
// Save Product Function
// Update Order Status Function
async function updateOrderStatus(orderId, newStatus) {
    if (!orderId || !newStatus) return;
    
    try {
        await db.collection('orders').doc(orderId).update({
            status: newStatus,
            updatedAt: firebase.firestore.FieldValue.serverTimestamp()
        });
        showNotification('Order status updated successfully!', 'success');
        
        // Optional: Refresh the orders list to show the updated status
        loadOrders();
    } catch (error) {
        console.error('Error updating order status:', error);
        showNotification('Error updating order status: ' + error.message, 'error');
    }
}
async function saveProduct(event) {
    event.preventDefault(); // Prevent form submission and page refresh
    
    try {
        const productId = document.getElementById('productId').value;
        const name = document.getElementById('productName').value;
        const description = document.getElementById('productDescription').value;
        const price = parseFloat(document.getElementById('productPrice').value);
        const category = document.getElementById('productCategory').value;
        
        // Get all image URLs
        const imageUrlInputs = document.querySelectorAll('.image-url-input');
        const imageUrls = Array.from(imageUrlInputs).map(input => input.value).filter(url => url.trim() !== '');
        
        // Get all features
        const featureInputs = document.querySelectorAll('.feature-input');
        const features = Array.from(featureInputs).map(input => input.value).filter(feature => feature.trim() !== '');
        
        // Validate required fields
        if (!name || !description || isNaN(price) || !category || imageUrls.length === 0 || features.length === 0) {
            showNotification('Please fill all required fields', 'error');
            return;
        }
        
        const productData = {
            name,
            description,
            price,
            category,
            imageUrl:imageUrls[0],
            imageUrls,
            features,
            createdAt: firebase.firestore.FieldValue.serverTimestamp()
        };
        
        if (productId) {
            // Update existing product
            await db.collection('products').doc(productId).update(productData);
            showNotification('Product updated successfully!', 'success');
        } else {
            // Add new product
            await db.collection('products').add(productData);
            showNotification('Product added successfully!', 'success');
        }
        
        // Close modal and refresh products list
        closeModal('productModal');
        loadProducts();
        
    } catch (error) {
        console.error('Error saving product:', error);
        showNotification('Error saving product: ' + error.message, 'error');
    }
}

// Update the form element in the product modal to include the onsubmit handler
document.getElementById('productForm').onsubmit = saveProduct;
        function closeModal(modalId) {
            const modal = document.getElementById(modalId);
            if (modal) {
                modal.style.display = 'none';
                if (modalId === 'productModal') {
                    resetProductForm();
                }
            }
        }

        // Initialize modal close buttons and click-outside functionality
        document.addEventListener('DOMContentLoaded', function() {
            // Close modals when clicking outside
            window.addEventListener('click', function(event) {
                const modals = document.querySelectorAll('.modal, .admin-modal');
                modals.forEach(modal => {
                    if (event.target === modal) {
                        modal.style.display = 'none';
                        if (modal.id === 'productModal') {
                            resetProductForm();
                        }
                    }
                });
            });
        });

        // Edit Discount Function
        async function editDiscount(discountId) {
            try {
                const doc = await db.collection('coupons').doc(discountId).get();
                if (!doc.exists) {
                    showNotification('Discount not found!', 'error');
                    return;
                }

                const discount = doc.data();

                // Populate the form for editing
                document.getElementById('discountId').value = discountId;
                document.getElementById('discountCode').value = discountId; // Use doc.id for the code
                document.getElementById('discountCode').disabled = true; // Prevent changing code during edit
                document.getElementById('discountType').value = discount.discountType || 'percentage';
                document.getElementById('discountValue').value = discount.discountValue || 0;
                document.getElementById('discountActive').checked = discount.active || false;

                // Change button text and form title
                document.querySelector('#discountForm button[type="submit"]').textContent = 'Update Discount';
                document.querySelector('#discountForm h4').textContent = 'Edit Discount';

            } catch (error) {
                console.error('Error fetching discount for edit:', error);
                showNotification('Error loading discount for edit: ' + error.message, 'error');
            }
        }

        // Enhanced Image URL Management
        function addImageUrlInput(value = '') {
            const container = document.getElementById('imageUrlsContainer');
            const inputGroup = document.createElement('div');
            inputGroup.className = 'image-url-input-group';
            
            const input = document.createElement('input');
            input.type = 'url';
            input.className = 'image-url-input';
            input.placeholder = 'Enter image URL';
            input.value = value;
            input.required = true;

            const previewButton = document.createElement('button');
            previewButton.type = 'button';
            previewButton.className = 'preview-image-btn';
            previewButton.innerHTML = '<i class="fas fa-eye"></i>';
            previewButton.onclick = function() {
                previewImage(input.value);
            };

            const removeButton = document.createElement('button');
            removeButton.type = 'button';
            removeButton.className = 'remove-image-url-btn';
            removeButton.innerHTML = '<i class="fas fa-minus"></i>';
            removeButton.onclick = function() {
                if (container.children.length > 1) {
                    container.removeChild(inputGroup);
                }
            };

            // Only show remove button if there are multiple inputs or if this is not the first one
            if (container.children.length > 0 || value !== '') {
                removeButton.style.display = 'inline-block';
            }

            inputGroup.appendChild(input);
            inputGroup.appendChild(previewButton);
            inputGroup.appendChild(removeButton);
            container.appendChild(inputGroup);
        }

        function removeImageUrlInput(element) {
            const container = document.getElementById('imageUrlsContainer');
            if (container.children.length > 1) {
                container.removeChild(element);
            }
        }

        // Enhanced Features Management
        function addFeatureInput(value = '') {
            const container = document.getElementById('featuresContainer');
            const featureDiv = document.createElement('div');
            featureDiv.className = 'feature-item';
            
            const input = document.createElement('input');
            input.type = 'text';
            input.className = 'feature-input';
            input.placeholder = 'Enter feature';
            input.value = value;
            input.required = true;

            const removeButton = document.createElement('button');
            removeButton.type = 'button';
            removeButton.className = 'remove-feature-btn';
            removeButton.innerHTML = '<i class="fas fa-minus"></i>';
            removeButton.onclick = () => {
                if (container.children.length > 1) {
                    container.removeChild(featureDiv);
                }
            };

            // Only show remove button if there are multiple inputs or if this is not the first one
            if (container.children.length > 0 || value !== '') {
                removeButton.style.display = 'inline-block';
            }

            featureDiv.appendChild(input);
            featureDiv.appendChild(removeButton);
            container.appendChild(featureDiv);
        }

        function removeFeatureInput(element) {
            const container = document.getElementById('featuresContainer');
            if (container.children.length > 1) {
                container.removeChild(element);
            }
        }

        // Reset Product Form
        function resetProductForm() {
            document.getElementById('productForm').reset();
            document.getElementById('productId').value = '';
            
            // Reset image URLs
            const imageUrlsContainer = document.getElementById('imageUrlsContainer');
            imageUrlsContainer.innerHTML = `
                <div class="image-url-input-group">
                    <input type="url" class="image-url-input" placeholder="Enter image URL" required>
                    <button type="button" class="preview-image-btn" onclick="previewImage(this.parentElement.querySelector('input').value)">
                        <i class="fas fa-eye"></i>
                    </button>
                    <button type="button" class="remove-image-url-btn" onclick="removeImageUrlInput(this.parentElement)" style="display: none;">
                        <i class="fas fa-minus"></i>
                    </button>
                </div>
            `;

            // Reset features
            const featuresContainer = document.getElementById('featuresContainer');
            featuresContainer.innerHTML = `
                <div class="feature-item">
                    <input type="text" class="feature-input" placeholder="Enter feature" required>
                    <button type="button" class="remove-feature-btn" onclick="removeFeatureInput(this.parentElement)" style="display: none;">
                        <i class="fas fa-minus"></i>
                    </button>
                </div>
            `;
        }

        // Show Add Product Modal
        function showAddProductModal() {
            resetProductForm();
            document.querySelector('#productModal h2').textContent = 'Add Product';
            document.getElementById('saveProductButton').textContent = 'Add Product';
            showModal('productModal');
        }

        // Image Preview Function
        function previewImage(url) {
            if (!url) return;

            // Create or get preview modal
            let previewModal = document.getElementById('imagePreviewModal');
            if (!previewModal) {
                previewModal = document.createElement('div');
                previewModal.id = 'imagePreviewModal';
                previewModal.className = 'modal';
                previewModal.innerHTML = `
                    <div class="modal-content" style="max-width: 800px; padding: 20px;">
                        <span class="close-button" onclick="closeModal('imagePreviewModal')">&times;</span>
                        <h3>Image Preview</h3>
                        <div class="image-preview-container">
                            <img id="previewImage" src="" alt="Preview" style="max-width: 100%; max-height: 70vh;">
                        </div>
                    </div>
                `;
                document.body.appendChild(previewModal);
            }

            const previewImage = document.getElementById('previewImage');
            previewImage.src = url;
            previewImage.onerror = function() {
                showNotification('Invalid image URL or image cannot be loaded', 'error');
                closeModal('imagePreviewModal');
            };

            showModal('imagePreviewModal');
        }

        // Search Products Function
        async function searchProducts() {
            const searchTerm = document.getElementById('productSearch').value.toLowerCase();
            const productsTableBody = document.querySelector('#productsTable tbody');
            const noProductsMessage = document.getElementById('noProductsMessage');
            
            if (!searchTerm) {
                loadProducts();
                return;
            }

            productsTableBody.innerHTML = '<tr><td colspan="4" style="text-align: center;">Searching products...</td></tr>';
            noProductsMessage.style.display = 'none';

            try {
                const snapshot = await db.collection('products').get();
                productsTableBody.innerHTML = '';
                
                if (snapshot.empty) {
                    noProductsMessage.style.display = 'block';
                    return;
                }

                let foundProducts = false;
                
                snapshot.forEach(doc => {
                    const product = doc.data();
                    const productName = product.name ? product.name.toLowerCase() : '';
                    
                    if (productName.includes(searchTerm)) {
                        foundProducts = true;
                        const row = productsTableBody.insertRow();
                        
                        // Add image cell
                        const imageCell = row.insertCell(0);
                        if (product.imageUrls && product.imageUrls.length > 0) {
                            const img = document.createElement('img');
                            img.src = product.imageUrls[0];
                            img.style.width = '50px';
                            img.style.height = '50px';
                            img.style.objectFit = 'cover';
                            imageCell.appendChild(img);
                        } else {
                            imageCell.textContent = 'No Image';
                        }

                        // Add other cells
                        row.insertCell(1).textContent = product.name || 'N/A';
                        row.insertCell(2).textContent = `PKR ${product.price ? product.price.toFixed(2) : '0.00'}`;
                        
                        // Add actions cell
                        const actionsCell = row.insertCell(3);
                        const editButton = document.createElement('button');
                        editButton.textContent = 'Edit';
                        editButton.onclick = () => editProduct(doc.id, product);
                        actionsCell.appendChild(editButton);

                        const deleteButton = document.createElement('button');
                        deleteButton.textContent = 'Delete';
                        deleteButton.className = 'delete-btn';
                        deleteButton.onclick = () => deleteProduct(doc.id);
                        actionsCell.appendChild(deleteButton);
                    }
                });

                if (!foundProducts) {
                    noProductsMessage.style.display = 'block';
                } else {
                    noProductsMessage.style.display = 'none';
                }
            } catch (error) {
                console.error('Error searching products:', error);
                productsTableBody.innerHTML = '<tr><td colspan="4" style="text-align: center; color: red;">Error searching products</td></tr>';
                noProductsMessage.style.display = 'none';
            }
        }

        // Load Products Function
        async function loadProducts() {
            console.log('Loading products...');
            const productsTableBody = document.querySelector('#productsTable tbody');
            const noProductsMessage = document.getElementById('noProductsMessage');
            
            productsTableBody.innerHTML = '<tr><td colspan="4" style="text-align: center;">Loading products...</td></tr>';
            noProductsMessage.style.display = 'none';

            try {
                const snapshot = await db.collection('products').get();
                productsTableBody.innerHTML = '';
                
                if (snapshot.empty) {
                    noProductsMessage.style.display = 'block';
                    return;
                }

                snapshot.forEach(doc => {
                    const product = doc.data();
                    const row = productsTableBody.insertRow();
                    
                    // Add image cell
                    const imageCell = row.insertCell(0);
                    if (product.imageUrls && product.imageUrls.length > 0) {
                        const img = document.createElement('img');
                        img.src = product.imageUrls[0];
                        img.style.width = '50px';
                        img.style.height = '50px';
                        img.style.objectFit = 'cover';
                        imageCell.appendChild(img);
                    } else {
                        imageCell.textContent = 'No Image';
                    }

                    // Add other cells
                    row.insertCell(1).textContent = product.name || 'N/A';
                    row.insertCell(2).textContent = `PKR ${product.price ? product.price.toFixed(2) : '0.00'}`;
                    
                    // Add actions cell
                    const actionsCell = row.insertCell(3);
                    const editButton = document.createElement('button');
                    editButton.textContent = 'Edit';
                    editButton.onclick = () => editProduct(doc.id, product);
                    actionsCell.appendChild(editButton);

                    const deleteButton = document.createElement('button');
                    deleteButton.textContent = 'Delete';
                    deleteButton.className = 'delete-btn';
                    deleteButton.onclick = () => deleteProduct(doc.id);
                    actionsCell.appendChild(deleteButton);
                });
            } catch (error) {
                console.error('Error loading products:', error);
                productsTableBody.innerHTML = '<tr><td colspan="4" style="text-align: center; color: red;">Error loading products</td></tr>';
                noProductsMessage.style.display = 'none';
            }
        }

        // Load Discounts Function
        async function loadDiscounts() {
            console.log('Loading discounts...');
            const discountsTableBody = document.querySelector('#discountsTable tbody');
            const noDiscountsMessage = document.getElementById('noDiscountsMessage');
            discountsTableBody.innerHTML = '<tr><td colspan="5" style="text-align: center;">Loading discounts...</td></tr>';
            noDiscountsMessage.style.display = 'none';

            try {
                const snapshot = await db.collection('coupons').get();
                discountsTableBody.innerHTML = '';
                if (snapshot.empty) {
                    noDiscountsMessage.style.display = 'block';
                    return;
                }
                snapshot.forEach((doc) => {
                    const discount = { id: doc.id, ...doc.data() };
                    const row = discountsTableBody.insertRow();
                    row.innerHTML = `
                        <td>${discount.id}</td>
                        <td>${discount.discountType || 'N/A'}</td>
                        <td>${discount.discountValue || 'N/A'}</td>
                        <td>${discount.active ? 'Yes' : 'No'}</td>
                        <td>
                            <button onclick="editDiscount('${discount.id}')" style="padding: 5px 10px; margin-right: 5px;">Edit</button>
                            <button onclick="deleteDiscount('${discount.id}')" class="delete-btn" style="padding: 5px 10px;">Delete</button>
                        </td>
                    `;
                });
            } catch (error) {
                console.error('Error loading discounts:', error);
                discountsTableBody.innerHTML = '<tr><td colspan="5" style="text-align: center; color: red;">Error loading discounts</td></tr>';
                noDiscountsMessage.style.display = 'none';
            }
        }

        // Load Customers Function
        async function loadCustomers() {
            console.log('Loading customers...');
            const customersTableBody = document.querySelector('#customersTable tbody');
            const noCustomersMessage = document.getElementById('noCustomersMessage');
            customersTableBody.innerHTML = '<tr><td colspan="4" style="text-align: center;">Loading customers...</td></tr>';
            noCustomersMessage.style.display = 'none';

            try {
                const snapshot = await db.collection('users').get();
                customersTableBody.innerHTML = '';
                if (snapshot.empty) {
                    noCustomersMessage.style.display = 'block';
                    return;
                }
                snapshot.forEach((doc) => {
                    const customer = { id: doc.id, ...doc.data() };
                    const row = customersTableBody.insertRow();
                    const memberSinceDate = customer.createdAt ? new Date(customer.createdAt.toDate()).toLocaleDateString() : 'N/A';
                    row.innerHTML = `
                        <td>${customer.email || 'N/A'}</td>
                        <td>${customer.name || 'N/A'}</td>
                        <td>${memberSinceDate}</td>
                        <td>
                            <button onclick="editCustomer('${customer.id}')" style="padding: 5px 10px; margin-right: 5px;">Edit</button>
                            <button onclick="deleteCustomer('${customer.id}')" class="delete-btn" style="padding: 5px 10px;">Delete</button>
                        </td>
                    `;
                });
            } catch (error) {
                console.error('Error loading customers:', error);
                customersTableBody.innerHTML = '<tr><td colspan="4" style="text-align: center; color: red;">Error loading customers</td></tr>';
                noCustomersMessage.style.display = 'none';
            }
        }

        // Load Orders Function
        async function loadOrders() {
            console.log('Loading orders...');
            const ordersTableBody = document.querySelector('#ordersTable tbody');
            const noOrdersMessage = document.getElementById('noOrdersMessage');
            ordersTableBody.innerHTML = '<tr><td colspan="9" style="text-align: center;">Loading orders...</td></tr>';
            noOrdersMessage.style.display = 'none';

            try {
                const snapshot = await db.collection('orders').orderBy('createdAt', 'desc').get();
                ordersTableBody.innerHTML = '';
                if (snapshot.empty) {
                    noOrdersMessage.style.display = 'block';
                    return;
                }
                
                // Fetch customer emails for orders
                const customerEmails = {};
                const userIds = [...new Set(snapshot.docs.map(doc => doc.data().userId))];
                if (userIds.length > 0) {
                    const usersSnapshot = await db.collection('users').where(firebase.firestore.FieldPath.documentId(), 'in', userIds).get();
                    usersSnapshot.forEach(doc => {
                        customerEmails[doc.id] = doc.data().email || 'N/A';
                    });
                }

                // In your loadOrders() function, update the row generation part:
snapshot.forEach((doc) => {
    const order = { id: doc.id, ...doc.data() };
    const row = ordersTableBody.insertRow();
    
    const orderDate = order.createdAt ? new Date(order.createdAt.toDate()).toLocaleDateString() : 'N/A';
    const total = order.total ? order.total.toFixed(2) : 'N/A';
    const status = order.status || 'PENDING'; // Default to PENDING if no status
    const payment = order.paymentMethod || 'N/A';
    const delivery = order.deliveryOption || 'N/A';
    const customerEmail = customerEmails[order.userId] || order.userId || 'N/A';
    const itemsList = order.items ? order.items.map(item => `<li>${item.name} (x${item.quantity})</li>`).join('') : 'No items';

    row.innerHTML = `
        <td>${order.id.slice(-6)}</td>
        <td>${customerEmail}</td>
        <td>${orderDate}</td>
        <td>PKR ${total}</td>
        <td>
            <select onchange="updateOrderStatus('${order.id}', this.value)">
                <option value="PENDING" ${status === 'PENDING' ? 'selected' : ''}>PENDING</option>
                <option value="PROCESSING" ${status === 'PROCESSING' ? 'selected' : ''}>PROCESSING</option>
                <option value="SHIPPED" ${status === 'SHIPPED' ? 'selected' : ''}>SHIPPED</option>
                <option value="DELIVERED" ${status === 'DELIVERED' ? 'selected' : ''}>DELIVERED</option>
                <option value="CANCELLED" ${status === 'CANCELLED' ? 'selected' : ''}>CANCELLED</option>
            </select>
        </td>
        <td>${payment}</td>
        <td>${delivery}</td>
        <td><ul>${itemsList}</ul></td>
        <td>
            <button style="padding: 5px 10px;" onclick="viewOrderDetails('${order.id}')">View Details</button>
        </td>
    `;
      
});
            } catch (error) {
                console.error('Error loading orders:', error);
                ordersTableBody.innerHTML = '<tr><td colspan="9" style="text-align: center; color: red;">Error loading orders</td></tr>';
                noOrdersMessage.style.display = 'none';
            }
        }
async function viewOrderDetails(orderId) {
    try {
        // Get the order document
        const orderDoc = await db.collection('orders').doc(orderId).get();
        
        if (!orderDoc.exists) {
            showNotification('Order not found!', 'error');
            return;
        }

        const order = orderDoc.data();
        
        // Get customer details if userId exists
        let customerEmail = 'N/A';
        let customerName = 'N/A';
        if (order.userId) {
            const customerDoc = await db.collection('users').doc(order.userId).get();
            if (customerDoc.exists) {
                const customer = customerDoc.data();
                customerEmail = customer.email || 'N/A';
                customerName = customer.name || 'N/A';
            }
        }

        // Format order date
        const orderDate = order.createdAt ? new Date(order.createdAt.toDate()).toLocaleString() : 'N/A';
        
        // Format order total
        const total = order.total ? order.total.toFixed(2) : 'N/A';
        
        // Create items list
        const itemsList = order.items 
            ? order.items.map(item => 
                `<li>
                    ${item.name || 'Unknown Item'} 
                    (x${item.quantity || 1}) - 
                    PKR ${item.price ? item.price.toFixed(2) : '0.00'}
                </li>`
              ).join('') 
            : '<li>No items in this order</li>';

        // Populate the modal with order details
        document.getElementById('orderDetailsId').textContent = orderId.slice(-6);
        document.getElementById('orderDetailsContent').innerHTML = `
            <p><strong>Order ID:</strong> ${orderId}</p>
            <p><strong>Date:</strong> ${orderDate}</p>
            <p><strong>Customer:</strong> ${customerName} (${customerEmail})</p>
            <p><strong>Status:</strong> <span class="status-${order.status ? order.status.toLowerCase() : 'pending'}">
                ${order.status || 'PENDING'}
            </span></p>
            <p><strong>Total:</strong> PKR ${total}</p>
            <p><strong>Payment Method:</strong> ${order.paymentMethod || 'N/A'}</p>
            <p><strong>Delivery Option:</strong> ${order.deliveryOption || 'N/A'}</p>
            
            <h4>Shipping Address</h4>
            <p>${order.shippingAddress || 'No shipping address provided'}</p>
            
            <h4>Order Items</h4>
            <ul>${itemsList}</ul>
            
            ${order.notes ? `<h4>Additional Notes</h4><p>${order.notes}</p>` : ''}
        `;

        // Show the modal
        showModal('orderDetailsModal');

    } catch (error) {
        console.error('Error loading order details:', error);
        showNotification('Error loading order details: ' + error.message, 'error');
    }
}
        // Edit Product Function
        async function editProduct(productId, product) {
            try {
                // Populate the form with product data
                document.getElementById('productId').value = productId;
                document.getElementById('productName').value = product.name || '';
                document.getElementById('productDescription').value = product.description || '';
                document.getElementById('productPrice').value = product.price || '';
                document.getElementById('productCategory').value = product.category || '';

                // Clear existing image URLs and features
                const imageUrlsContainer = document.getElementById('imageUrlsContainer');
                const featuresContainer = document.getElementById('featuresContainer');
                imageUrlsContainer.innerHTML = '';
                featuresContainer.innerHTML = '';

                // Add image URLs
                if (product.imageUrls && product.imageUrls.length > 0) {
                    product.imageUrls.forEach(url => addImageUrlInput(url));
                } else {
                    addImageUrlInput(); // Add one empty input if no images
                }

                // Add features
                if (product.features && product.features.length > 0) {
                    product.features.forEach(feature => addFeatureInput(feature));
                } else {
                    addFeatureInput(); // Add one empty input if no features
                }

                // Change form title and button text
                document.querySelector('#productModal h2').textContent = 'Edit Product';
                document.getElementById('saveProductButton').textContent = 'Update Product';

                // Show the modal
                showModal('productModal');

            } catch (error) {
                console.error('Error loading product for edit:', error);
                showNotification('Error loading product for edit: ' + error.message, 'error');
            }
        }

        // Delete Product Function
        async function deleteProduct(productId) {
            if (!confirm('Are you sure you want to delete this product?')) {
                return;
            }

            try {
                await db.collection('products').doc(productId).delete();
                showNotification('Product deleted successfully!', 'success');
                loadProducts(); // Reload the products list
            } catch (error) {
                console.error('Error deleting product:', error);
                showNotification('Error deleting product: ' + error.message, 'error');
            }
        }

        // Show Notification Function
        function showNotification(message, type = 'success') {
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.textContent = message;
            document.body.appendChild(notification);

            // Remove notification after 3 seconds
            setTimeout(() => {
                notification.remove();
            }, 3000);
        }

    </script>
</body>
</html>